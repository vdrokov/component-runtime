
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Talend Component Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="date" content="2017-12-362 10:58:37" scheme="YYYY-MM-DD HH:mm:ss">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.0/css/font-awesome.min.css" integrity="sha256-MUe1D3T3ocGLZQ2h8wgpcIz5BoTu1OZo8q0BjK5u/o0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
    <!--[if lt IE 9]>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.ie.min.css" />
    <![endif]-->
    <link rel="stylesheet" href="css/documentation.css">
    <link rel="shortcut icon" href="images/favicon_0.ico" />
    <style>
    body{padding-top:50px}body>.navbar{-webkit-transition:background-color .3s ease-in;transition:background-color .3s ease-in}@media (min-width:768px){body>.navbar-transparent{background-color:transparent}body>.navbar-transparent .navbar-nav>.open>a{background-color:transparent!important}}#home{padding-top:0}#home .navbar-brand{padding:13.5px 15px 12.5px}#home .navbar-brand>img{display:inline;margin:0 10px;height:100%}#banner{min-height:300px;border-bottom:none}.table-of-contents{margin-top:1em}.page-header h1{font-size:4em}.bs-docs-section{margin-top:6em}.bs-docs-section h1{padding-top:100px}.bs-component{position:relative}.bs-component .modal{position:relative;top:auto;right:auto;left:auto;bottom:auto;z-index:1;display:block}.bs-component .modal-dialog{width:90%}.bs-component .popover{position:relative;display:inline-block;width:220px;margin:20px}#source-button{position:absolute;top:0;right:0;z-index:100;font-weight:700}.progress{margin-bottom:10px}footer{margin:5em 0}footer li{float:left;margin-right:1.5em;margin-bottom:1.5em}footer p{clear:left;margin-bottom:0}.splash{padding:9em 0 2em;background-color:#141d27;background-image:url(../img/bg.jpg);background-size:cover;background-attachment:fixed;color:#fff;text-align:center}.splash .logo{width:160px}.splash h1{font-size:3em}.splash #social{margin:2em 0}.splash .alert{margin:2em 0}.section-tout{padding:4em 0 3em;border-bottom:1px solid rgba(0,0,0,.05);background-color:#eaf1f1}.section-tout .fa{margin-right:.5em}.section-tout p{margin-bottom:3em}.section-preview{padding:4em 0 4em}.section-preview .preview{margin-bottom:4em;background-color:#eaf1f1}.section-preview .preview .image{position:relative}.section-preview .preview .image:before{box-shadow:inset 0 0 0 1px rgba(0,0,0,.1);position:absolute;top:0;left:0;width:100%;height:100%;content:"";pointer-events:none}.section-preview .preview .options{padding:1em 2em 2em;border:1px solid rgba(0,0,0,.05);border-top:none;text-align:center}.section-preview .preview .options p{margin-bottom:2em}.section-preview .dropdown-menu{text-align:left}.section-preview .lead{margin-bottom:2em}@media (max-width:767px){.section-preview .image img{width:100%}}.sponsor #carbonads{max-width:240px;margin:0 auto}.sponsor .carbon-text{display:block;margin-top:1em;font-size:12px}.sponsor .carbon-poweredby{float:right;margin-top:1em;font-size:10px}@media (max-width:767px){.splash{padding-top:4em}.splash .logo{width:100px}.splash h1{font-size:2em}#banner{margin-bottom:2em;text-align:center}}
    </style>
  </head>
  <body>
    <a class="github-fork-ribbon" target="_blank"
        href="https://github.com/talend/component-runtime" data-ribbon="Fork me on GitHub"
        title="Fork me on GitHub">Fork me on GitHub</a>
    <div class="col-sm-offset-1 col-sm-10">

	
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a href="/component-runtime/index.html" class="navbar-brand">Component Kit</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="entries">Documentation <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="entries">
            <li><a href="/component-runtime/index.html">Home</a></li>
            <li><a href="documentation-overview.html">Overview</a></li>
            <li><a href="getting-started.html">Getting Started</a></li>
            <li><a href="documentation.html">Reference</a></li>
            <li><a href="best-practices.html">Best Practices</a></li>
            <li><a href="documentation-testing.html">Testing</a></li>
            <li><a href="documentation-rest.html">REST API</a></li>
            <li><a href="wrapping-a-beam-io.html">How to wrap a Beam I/O</a></li>
            <li><a href="studio.html">Studio Integration</a></li>
            <li><a href="changelog.html">Changelog</a></li>
            <li><a href="contributors.html">Wall of Fame</a></li>
            <li><a href="apidocs.html">API Documentation</a></li>
            <li><a href="appendix.html">Appendix</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="versions">Versions <span class="caret"></span></a>
          <ul class="dropdown-menu" aria-labelledby="versions">
            <li><a href="/component-runtime/index.html">Current</a></li>
            <li><a href="/component-runtime/latest/index.html">Latest</a></li>
            
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>


    <div class="container section-padded">
        <div class="row title">
            <div class='page-header'>
              <h2>Talend Component Documentation</h2>
            </div>
        </div>
        <div class="row">
            
            <div class="col-md-12">
                <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_components_definitions">1. Components Definitions</a>
<ul class="sectlevel2">
<li><a href="#_partitionmapper">1.1. PartitionMapper</a></li>
<li><a href="#_producer">1.2. Producer</a></li>
<li><a href="#_processor">1.3. Processor</a></li>
<li><a href="#_multiple_outputs">1.4. Multiple outputs</a></li>
<li><a href="#_multiple_inputs">1.5. Multiple inputs</a></li>
<li><a href="#_combiners">1.6. Combiners?</a></li>
</ul>
</li>
<li><a href="#_registering_components">2. Registering components</a>
<ul class="sectlevel2">
<li><a href="#_components_metadata">2.1. Components metadata</a></li>
</ul>
</li>
<li><a href="#_internationalization">3. Internationalization</a>
<ul class="sectlevel2">
<li><a href="#_internationalization_api">3.1. Internationalization API</a></li>
<li><a href="#_default_components_keys">3.2. Default components keys</a></li>
</ul>
</li>
<li><a href="#_component_loading">4. Component loading</a>
<ul class="sectlevel2">
<li><a href="#_packaging_a_plugin">4.1. Packaging a plugin</a></li>
<li><a href="#_packaging_an_application">4.2. Packaging an application</a></li>
</ul>
</li>
<li><a href="#_configuring_component">5. Configuring component</a>
<ul class="sectlevel2">
<li><a href="#_primitives">5.1. Primitives</a></li>
<li><a href="#_complex_object_mapping">5.2. Complex object mapping</a></li>
<li><a href="#_constraints_and_validation_on_the_configuration_input">5.3. Constraints and validation on the configuration/input</a></li>
<li><a href="#_marking_a_configuration_as_a_particular_type_of_data">5.4. Marking a configuration as a particular type of data</a></li>
<li><a href="#_define_links_between_properties">5.5. Define links between properties</a></li>
<li><a href="#documentation-ui-hints">5.6. Add hints about the rendering based on configuration/component knowledge</a></li>
</ul>
</li>
<li><a href="#_providing_some_actions_for_consumers_clients">6. Providing some actions for consumers/clients</a>
<ul class="sectlevel2">
<li><a href="#_particular_action_types">6.1. Particular action types</a></li>
</ul>
</li>
<li><a href="#_built_in_services">7. Built in services</a>
<ul class="sectlevel2">
<li><a href="#_httpclient_usage">7.1. HttpClient usage</a></li>
</ul>
</li>
<li><a href="#_services_and_interceptors">8. Services and interceptors</a></li>
<li><a href="#_creating_an_execution_chain_or_pipeline">9. Creating an execution chain or pipeline</a>
<ul class="sectlevel2">
<li><a href="#_standalone_chains">9.1. Standalone chains</a></li>
<li><a href="#_beam_case">9.2. Beam case</a></li>
</ul>
</li>
<li><a href="#_maven_plugin">10. Maven Plugin</a>
<ul class="sectlevel2">
<li><a href="#_dependencies_2">10.1. Dependencies</a></li>
<li><a href="#_validate">10.2. Validate</a></li>
<li><a href="#_documentation">10.3. Documentation</a></li>
<li><a href="#_prepare">10.4. Prepare</a></li>
<li><a href="#_generate_inputs_or_outputs">10.5. Generate inputs or outputs</a></li>
</ul>
</li>
<li><a href="#_gradle_plugin">11. Gradle Plugin</a></li>
<li><a href="#_advanced_define_a_custom_api">12. Advanced: define a custom API</a>
<ul class="sectlevel2">
<li><a href="#_extending_the_ui">12.1. Extending the UI</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_components_definitions">1. Components Definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Talend Component framework relies on several primitive components.</p>
</div>
<div class="paragraph">
<p>They can all use <code>@PostConstruct</code> and <code>@PreDestroy</code> to initialize/release
some underlying resource at the beginning/end of the processing.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
in distributed environments class' constructor will be called on cluster manager node, methods annotated with
<code>@PostConstruct</code> and <code>@PreDestroy</code> annotations will be called on worker nodes. Thus, partition plan computation and pipeline task
will be performed on different nodes.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-deployment-diagram.png" alt="generated deployment diagram" width="490" height="392">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Created task consists of Jar file, containing class, which describes pipeline(flow) which should be processed in cluster.</p>
</li>
<li>
<p>During partition plan computation step pipeline is analyzed and split into stages. Cluster Manager node instantiates mappers/processors
gets estimated data size using mappers, splits created mappers according to the estimated data size. All instances are serialized and
sent to Worker nodes afterwards.</p>
</li>
<li>
<p>Serialized instances are received and deserialized, methods annotated with @PostConstruct annotation are called. After that,
pipeline execution is started. Processor&#8217;s @BeforeGroup annotated method is called before processing first element in chunk.
After processing number of records estimated as chunk size, Processor&#8217;s @AfterGroup annotated method called. Chunk size is calculated
depending on environment the pipeline is processed by. After pipeline is processed, methods annotated with @PreDestroy annotation are called.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-driver-processing-workflow.png" alt="generated driver processing workflow" width="330" height="266">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-worker-processing-workflow.png" alt="generated worker processing workflow" width="240" height="476">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
all framework managed methods <code>MUST</code> be public too. Private methods are ignored.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
in term of design the framework tries to be as declarative as possible but also to stay extensible
not using fixed interfaces or method signatures. This will allow to add incrementally new features of the underlying implementations.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_partitionmapper">1.1. PartitionMapper</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <code>PartitionMapper</code> is a component able to split itself to
make the execution more efficient.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This concept is borrowed to big data world and useful only in this context (<code>BEAM</code> executions).
Overall idea is to divide the work before executing it to try to reduce the overall execution time.</p>
</div>
<div class="paragraph">
<p>The process is the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Estimate the size of the data you will work on. This part is often heuristic and not very precise.</p>
</li>
<li>
<p>From that size the execution engine (<em>runner</em> for beam) will request the mapper to split <em>itself</em> in <em>N</em> mappers with a subset of the overall work.</p>
</li>
<li>
<p>The <em>leaf</em> (final) mappers will be used as a <code>Producer</code> (actual reader) factory.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this kind of component <code>MUST</code> be <code>Serializable</code> to be distributable.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_definition">1.1.1. Definition</h4>
<div class="paragraph">
<p>A partition mapper requires 3 methods marked with specific annotations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>@Assessor</code> for the evaluating method</p>
</li>
<li>
<p><code>@Split</code> for the dividing method</p>
</li>
<li>
<p><code>@Emitter</code> for the <code>Producer</code> factory</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_assessor">@Assessor</h5>
<div class="paragraph">
<p>The assessor method will return the estimated size of the data related to the component (depending its configuration).
It <code>MUST</code> return a <code>Number</code> and <code>MUST</code> not take any parameter.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Assessor</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">long</span> estimateDataSetByteSize() {
    <span style="color:#080;font-weight:bold">return</span> ....;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_split">@Split</h5>
<div class="paragraph">
<p>The split method will return a collection of partition mappers and can take optionally a <code>@PartitionSize</code> long
value which is the requested size of the dataset per sub partition mapper.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Split</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;MyMapper&gt; split(<span style="color:#007">@PartitionSize</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">long</span> desiredSize) {
    <span style="color:#080;font-weight:bold">return</span> ....;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_emitter">@Emitter</h5>
<div class="paragraph">
<p>The emitter method <code>MUST</code> not have any parameter and <code>MUST</code> return a producer. It generally uses the partition mapper configuration
to instantiate/configure the producer.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Emitter</span>
<span style="color:#088;font-weight:bold">public</span> MyProducer create() {
    <span style="color:#080;font-weight:bold">return</span> ....;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_producer">1.2. Producer</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>AÂ <code>Producer</code> is the component interacting with a physical source. It produces input data for the processing flow.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A producer is a very simple component which <code>MUST</code> have a <code>@Producer</code> method without any parameter and returning any data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Producer</span>
<span style="color:#088;font-weight:bold">public</span> MyData produces() {
    <span style="color:#080;font-weight:bold">return</span> ...;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor">1.3. Processor</h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <code>Processor</code> is a component responsible to convert an incoming data to another model.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>A processor <code>MUST</code> have a method decorated with <code>@ElementListener</code> taking an incoming data and returning the processed data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> MyData data) {
    <span style="color:#080;font-weight:bold">return</span> ...;
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this kind of component <code>MUST</code> be <code>Serializable</code> since it is distributed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
if you don&#8217;t care much of the type of the parameter and need to access data on a "map like" based rule set, then you can
use <code>ObjectMap</code> as parameter type and Talend Component will just wrap the data to enable you to access it as a map. The parameter
type is not enforced, i.e. if you know you will get a <code>SuperCustomDto</code> then you can use that as parameter type but for generic
component reusable in any chain it is more than highly encouraged to use <code>ObjectMap</code> until you have your an evaluation language
based processor (which has its own way to access component). Here is an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> ObjectMap incomingData) {
    <span style="color:#0a8;font-weight:bold">String</span> name = <span style="color:#0a8;font-weight:bold">String</span>.class.cast(incomingData.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name</span><span style="color:#710">&quot;</span></span>));
    <span style="color:#339;font-weight:bold">int</span> name = <span style="color:#0a8;font-weight:bold">Integer</span>.class.cast(incomingData.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">age</span><span style="color:#710">&quot;</span></span>));
    <span style="color:#080;font-weight:bold">return</span> ...;
}

<span style="color:#777">// equivalent to (using POJO subclassing)</span>

<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Person</span> {
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> age;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> age;

    <span style="color:#777">// getters/setters</span>
}

<span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> Person person) {
    <span style="color:#0a8;font-weight:bold">String</span> name = person.getName();
    <span style="color:#339;font-weight:bold">int</span> name = person.getAge();
    <span style="color:#080;font-weight:bold">return</span> ...;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A processor also supports <code>@BeforeGroup</code> and <code>@AfterGroup</code> which <code>MUST</code> be methods without parameters and returning <code>void</code> (result would be ignored).
This is used by the runtime to mark a chunk of the data in a way which is estimated <em>good</em> for the execution flow size.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this is estimated so you don&#8217;t have any guarantee on the size of a <em>group</em>. You can literally have groups of size 1.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The common usage is to batch records for performance reasons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@BeforeGroup</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> initBatch() {
    <span style="color:#777">// ...</span>
}

<span style="color:#007">@AfterGroup</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> endBatch() {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
it is a good practise to support a <code>maxBatchSize</code> here and potentially commit before the end of the group in case
of a computed size which is way too big for your backend.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_objectmap_and_dynamic_schemas">1.3.1. ObjectMap and dynamic schemas</h4>
<div class="paragraph">
<p>If you don&#8217;t know at coding time the structure of your object you can use <code>@ObjectMap.Any</code> on a <code>Map&lt;String, Object&gt;</code> field
which means the <code>ObjectMap</code> mapping will use the (unique) decorated field to find any entry in the object.</p>
</div>
<div class="paragraph">
<p>For instance with this model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JdbcRecord</span> {
    <span style="color:#007">@Any</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">Object</span>&gt; columnValues;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the framework will be able to access any column:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Object</span> name = jdbcRecordObjectMap.get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name</span><span style="color:#710">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_outputs">1.4. Multiple outputs</h3>
<div class="paragraph">
<p>In some case you may want to split the output of a processor in two. A common example is "main" and "reject" branches
where part of the incoming data are put in a specific bucket to be processed later.</p>
</div>
<div class="paragraph">
<p>This can be done using <code>@Output</code>. This can be used as a replacement of the returned value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> map(<span style="color:#088;font-weight:bold">final</span> MyData data, <span style="color:#007">@Output</span> <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewData&gt; output) {
    output.emit(createNewData(data));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can pass it a string which will represent the new branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> map(<span style="color:#088;font-weight:bold">final</span> MyData data,
                <span style="color:#007">@Output</span> <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewData&gt; main,
                <span style="color:#007">@Output</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rejected</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewDataWithError&gt; rejected) {
    <span style="color:#080;font-weight:bold">if</span> (isRejected(data)) {
        rejected.emit(createNewData(data));
    } <span style="color:#080;font-weight:bold">else</span> {
        main.emit(createNewData(data));
    }
}

<span style="color:#777">// or simply</span>

<span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#088;font-weight:bold">final</span> MyData data,
                    <span style="color:#007">@Output</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rejected</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> OutputEmitter&lt;MyNewDataWithError&gt; rejected) {
    <span style="color:#080;font-weight:bold">if</span> (isSuspicious(data)) {
        rejected.emit(createNewData(data));
        <span style="color:#080;font-weight:bold">return</span> createNewData(data); <span style="color:#777">// in this case we continue the processing anyway but notified another channel</span>
    }
    <span style="color:#080;font-weight:bold">return</span> createNewData(data);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_inputs">1.5. Multiple inputs</h3>
<div class="paragraph">
<p>Having multiple inputs is closeto the output case excep it doesn&#8217;t require a wrapper <code>OutputEmitter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> MyNewData map(<span style="color:#007">@Input</span> <span style="color:#088;font-weight:bold">final</span> MyData data, <span style="color:#007">@Input</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">input2</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> MyData2 data2) {
    <span style="color:#080;font-weight:bold">return</span> createNewData(data1, data2);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Input</code> takes the input name as parameter, if not set it uses the main (default) input branch.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
due to the work required to not use the default branch it is recommanded to use it when possible and not
name its branches depending on the component semantic.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_output">1.5.1. Output</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>An <code>Output</code> is a <code>Processor</code> returning no data.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Conceptually an output is a listener of data. It perfectly matches the concept of processor. Being the last of the execution chain
or returning no data will make your processor an output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@ElementListener</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> store(<span style="color:#088;font-weight:bold">final</span> MyData data) {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_combiners">1.6. Combiners?</h3>
<div class="paragraph">
<p>For now Talend Component doesn&#8217;t enable you to define a <code>Combiner</code>. It would be the symmetric part of the partition mapper
and allow to aggregate results in a single one.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registering_components">2. Registering components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As seen in the <a href="getting-started.html#getting-started-first-quick-start">Getting Started</a>, you need an annotation to register
your component through <code>family</code> method. Multiple components can use the same <code>family</code> value but the pair <code>family</code>+<code>name</code>
<code>MUST</code> be unique for the system.</p>
</div>
<div class="paragraph">
<p>If you desire (recommended) to share the same component family name instead of repeating yourself in all <code>family</code> methods,
you can use <code>@Components</code> annotation on the root package of you component, it will enable you to define the component family and
the categories the component belongs to (default is <code>Misc</code> if not set). Here is a sample <code>package-info.java</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Components</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_component_family</span><span style="color:#710">&quot;</span></span>, categories = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">My Category</span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">org.talend.sdk.component.sample</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.talend.sdk.component.api.component.Components</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For an existing component it can look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Components</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Salesforce</span><span style="color:#710">&quot;</span></span>, categories = {<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Business</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Cloud</span><span style="color:#710">&quot;</span></span>})
<span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">org.talend.sdk.component.sample</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.talend.sdk.component.api.component.Components</span>;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_components_metadata">2.1. Components metadata</h3>
<div class="paragraph">
<p>Components can require a few metadata to be integrated in Talend Studio or Cloud platform. Here is how to provide these information.
These metadata are set on the component class and belongs to <code>org.talend.sdk.component.api.component</code> package.</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set an icon key used to represent the component. Note you can use a custom key with <code>custom()</code> method but it is not guaranteed the icon will be rendered properly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the component version, default to 1.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Icon</span>(FILE_XML_O)
<span style="color:#007">@PartitionMapper</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">jaxbInput</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">JaxbPartitionMapper</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Serializable</span> {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_management_of_configuration_versions">2.1.1. Management of configuration versions</h4>
<div class="paragraph">
<p>If some impacting changes happen on the configuration they can be manage through a migration handler at <strong>component</strong> level (to enable
to support trans-model migration).</p>
</div>
<div class="paragraph">
<p>The <code>@Version</code> annotation supports a <code>migrationHandler</code> method which will take the implementation migrating the incoming configuration
to the current model.</p>
</div>
<div class="paragraph">
<p>For instance if <code>filepath</code> configuration entry from v1 changed to <code>location</code> in v2 you can remap the value to the right key in your
<code>MigrationHandler</code> implementation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
it is recommanded to not manage all migrations in the handler but rather split it in services you inject in the migration handler
(through constructor):
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#777">// full component code structure skipped for brievity, kept only migration part</span>
<span style="color:#007">@Version</span>(value = <span style="color:#00D">3</span>, migrationHandler = MyComponent.Migrations.class)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyComponent</span> {
    <span style="color:#777">// the component code...</span>


    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">VersionConfigurationHandler</span> {
        <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; migrate(<span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; incomingData);
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Migrations</span> {
        <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;VersionConfigurationHandler&gt; handlers;

        <span style="color:#777">// VersionConfigurationHandler implementations are decorated with @Service</span>
        <span style="color:#088;font-weight:bold">public</span> Migrations(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;VersionConfigurationHandler&gt; migrations) {
            <span style="color:#950">this</span>.handlers = migrations;
            <span style="color:#950">this</span>.handlers.sort(<span style="color:#777">/*some custom logic*/</span>);
        }

        <span style="color:#007">@Override</span>
        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; migrate(<span style="color:#339;font-weight:bold">int</span> incomingVersion, <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; incomingData) {
            <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; out = incomingData;
            <span style="color:#080;font-weight:bold">for</span> (MigrationHandler handler : handlers) {
                out = handler.migrate(out);
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is important in this snippet is not much the way the code is organized but rather the fact you organize your migrations the way which fits the best
your component. If migrations are not conflicting no need of something fancy, just apply them all but if you need to apply them in order
you need to ensure they are sorted. Said otherwise: don&#8217;t see this API as a migration API but as a migration callback
and adjust the migration code structure you need behind the <code>MigrationHandler</code> based on your
component requirements. The service injection enables you to do so.</p>
</div>
</div>
<div class="sect3">
<h4 id="_partitionmapper_2">2.1.2. @PartitionMapper</h4>
<div class="paragraph">
<p><code>@PartitionMapper</code> will obviously mark a partition mapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@PartitionMapper</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_mapper</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyMapper</span> {
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_emitter_2">@Emitter</h5>
<div class="paragraph">
<p><code>@Emitter</code> is a shortcut for <code>@PartitionMapper</code> when you don&#8217;t support distribution. Said otherwise it will enforce an implicit
partition mapper execution with an assessor size of 1 and a split returning itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Emitter</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_input</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyInput</span> {
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processor_2">2.1.3. @Processor</h4>
<div class="paragraph">
<p>A method decorated with <code>@Processor</code> will be considered as a producer factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Processor</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my_processor</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProcessor</span> {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internationalization">3. Internationalization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Recommanded practise for internationalization are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>store messages using <code>ResourceBundle</code> properties file in your component module</p>
</li>
<li>
<p>the location of the properties are in the same package than the related component(s) and is named <code>Messages</code> (ex: <code>org.talend.demo.MyComponent</code> will use <code>org.talend.demo.Messages[locale].properties</code>)</p>
</li>
<li>
<p>for your own messages use the internationalization API</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_internationalization_api">3.1. Internationalization API</h3>
<div class="paragraph">
<p>Overal idea is to design its messages as methods returning <code>String</code> values
and back the template by a <code>ResourceBundle</code> located in the same package than the interface
defining these methods and named <code>Messages</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this is the mecanism to use to internationalize your own messages in your own components.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To ensure you internationalization API is identified you need to mark it with <code>@Internationalized</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Internationalized</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">Translator</span> {

    <span style="color:#0a8;font-weight:bold">String</span> message();

    <span style="color:#0a8;font-weight:bold">String</span> templatizedMessage(<span style="color:#0a8;font-weight:bold">String</span> arg0, <span style="color:#339;font-weight:bold">int</span> arg1); <i class="conum" data-value="2"></i><b>(2)</b>

    <span style="color:#0a8;font-weight:bold">String</span> localized(<span style="color:#0a8;font-weight:bold">String</span> arg0, <span style="color:#007">@Language</span> <span style="color:#0a8;font-weight:bold">Locale</span> locale); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Internationalized</code> allows to mark a class as a i18n service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you can pass parameters and the message will use <code>MessageFormat</code> syntax to be resolved based on the <code>ResourceBundle</code> template</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you can use <code>@Language</code> on a <code>Locale</code> parameter to specify manually the locale to use, note that a single value will be used (the first parameter tagged as such).</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_default_components_keys">3.2. Default components keys</h3>
<div class="paragraph">
<p>Out of the box components are internationalized using the same location logic for the resource bundle and here is the list
of supported keys:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name Pattern</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${family}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the family</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${family}.${configurationType}.${name}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of a configuration type (dataStore or dataSet)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${family}.${component_name}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the component (used by the GUIs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${property_path}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${simple_class_name}.${property_name}._displayName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the display name of the option using it class name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example of configuration for a component named <code>list</code> belonging to the family <code>memory</code> (<code>@Emitter(family = "memory", name = "list")</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>memory.list._displayName = Memory List</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration class are also translatable using the simple class name in the messages properties file.
This useful when you have some common configuration shared within multiple components.</p>
</div>
<div class="paragraph">
<p>If you have a configuration class like :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyConfig</span> {

    <span style="color:#007">@Option</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> host;

    <span style="color:#007">@Option</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> port;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can give it a translatable display name by adding ${simple_class_name}.${property_name}._displayName to Messages.properties under the same package as the config class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>MyConfig.host._displayName = Server Host Name
MyConfig.port._displayName = Server Port</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you have a display name using the property path, it will override the display name defined using the simple class name
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_component_loading">4. Component loading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Talend Component scanning is based on a plugin concept. To ensure plugins can be developped in parallel and avoid conflicts
it requires to isolate plugins (components or component grouped in a single jar/plugin).</p>
</div>
<div class="paragraph">
<p>Here we have multiple options which are (high level):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>flat classpath: listed for completeness but rejected <em>by design</em> because it doesn&#8217;t match at all this requirement.</p>
</li>
<li>
<p>tree classloading: a shared classloader inherited by plugin classloaders but plugin classloader classes
are not seen by the shared classloader nor by other plugins.</p>
</li>
<li>
<p>graph classloading: this one allows you to link the plugins and dependencies together dynamically in any direction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to map it to concrete common examples, the tree classloading is commonly used by Servlet containers where plugins are web applications
and the graph classloading can be illustrated by OSGi containers.</p>
</div>
<div class="paragraph">
<p>In the spirit of avoiding a lot of complexity added by this layer, Talend Component relies on a tree classloading. The advantage
is you don&#8217;t need to define the relationship with other plugins/dependencies (it is built-in).</p>
</div>
<div class="paragraph">
<p>Here is a representation of this solution:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/generated-classloader-layout.png" alt="generated classloader layout" width="480" height="168">
</div>
</div>
<div class="paragraph">
<p>The interesting part is the <em>shared</em> area will contain Talend Component API which is the only (by default) shared classes accross the whole plugins.</p>
</div>
<div class="paragraph">
<p>Then each plugins will be loaded in their own classloader with their dependencies.</p>
</div>
<div class="sect2">
<h3 id="_packaging_a_plugin">4.1. Packaging a plugin</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
this part explains the overall way to handle dependecnies but the Talend Maven plugin provides a shortcut for that.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A plugin is just a jar which was enriched with the list of its dependencies. By default Talend Component runtime is able to
read the output of <code>maven-dependency-plugin</code> in <code>TALEND-INF/dependencies.txt</code> location so you just need to ensure your component defines the following plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-dependency-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.2<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>create-TALEND-INF/dependencies.txt<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>process-resources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>list<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputFile&gt;</span>${project.build.outputDirectory}/TALEND-INF/dependencies.txt<span style="color:#070;font-weight:bold">&lt;/outputFile&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you check your jar once built you will see that the file contains something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ unzip -p target/mycomponent-1.0.0-SNAPSHOT.jar TALEND-INF/dependencies.txt

The following files have been resolved:
   org.talend.sdk.component:component-api:jar:1.0.0-SNAPSHOT:provided
   org.apache.geronimo.specs:geronimo-annotation_1.3_spec:jar:1.0:provided
   org.superbiz:awesome-project:jar:1.2.3:compile
   junit:junit:jar:4.12:test
   org.hamcrest:hamcrest-core:jar:1.3:test</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is important to see is the scope associated to the artifacts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the API (<code>component-api</code> and <code>geronimo-annotation_1.3_spec</code>) are <code>provided</code> because you can consider them to be there when executing (it comes with the framework)</p>
</li>
<li>
<p>your specific dependencies (<code>awesome-project</code>) is <code>compile</code>: it will be included as a needed dependency by the framework (note that using <code>runtime</code> works too).</p>
</li>
<li>
<p>the other dependencies will be ignored (<code>test</code> dependencies)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_packaging_an_application">4.2. Packaging an application</h3>
<div class="paragraph">
<p>Even if a flat classpath deployment is possible, it is not recommanded because it would then reduce the capabilities of the components.</p>
</div>
<div class="sect3">
<h4 id="_dependencies">4.2.1. Dependencies</h4>
<div class="paragraph">
<p>The way the framework resolves dependencies is based on a local maven repository layout. As a quick reminder it looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>.
âââ groupId1
âÂ Â  âââ artifactId1
âÂ Â      âââ version1
âÂ Â      âÂ Â  âââ artifactId1-version1.jar
âÂ Â      âââ version2
âÂ Â       Â Â  âââ artifactId1-version2.jar
âââ groupId2
 Â Â  âââ artifactId2
 Â Â      âââ version1
 Â Â       Â Â  âââ artifactId2-version1.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all the layout the framework will use. Concretely the logic will convert the t-uple {groupId, artifactId, version, type (jar)}
to the path in the repository.</p>
</div>
<div class="paragraph">
<p>Talend Component runtime has two ways to find an artifact:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from the file system based on a configure maven 2 repository.</p>
</li>
<li>
<p>from a fatjar (uber jar) with a nested maven repository under <code>MAVEN-INF/repository</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first option will use either - by default - <code>${user.home}/.m2/repository</code> or a specific path configured when creating a <code>ComponentManager</code>.
The nested repository option will need some configuration during the packaging to ensure the repository is well created.</p>
</div>
<div class="sect4">
<h5 id="_create_a_nested_maven_repository_with_maven_shade_plugin">Create a nested maven repository with maven-shade-plugin</h5>
<div class="paragraph">
<p>To create the nested <code>MAVEN-INF/repository</code> repository you can use <code>nested-maven-repository</code> extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-shade-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>shade<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;transformers&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.ContainerDependenciesTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/project&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/transformers&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>nested-maven-repository<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${the.plugin.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_listing_needed_plugins">4.2.2. Listing needed plugins</h4>
<div class="paragraph">
<p>Plugin are programmatically registered in general but if you want to make some of them automatically available you
need to generate a <code>TALEND-INF/plugins.properties</code> which will map a plugin name to coordinates found with the maven mecanism
we just talked about.</p>
</div>
<div class="paragraph">
<p>Here again we can enrich <code>maven-shade-plugin</code> to do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-shade-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>shade<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;transformers&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.PluginTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/project&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/transformers&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>nested-maven-repository<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${the.plugin.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_maven_shade_plugin_code_extensions">4.2.3. <code>maven-shade-plugin</code> extensions</h4>
<div class="paragraph">
<p>Here is a final job/application bundle based on maven shade plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>maven-shade-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>3.0.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;createDependencyReducedPom&gt;</span>false<span style="color:#070;font-weight:bold">&lt;/createDependencyReducedPom&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;filters&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;filter&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;artifact&gt;</span><strong>:</strong><span style="color:#070;font-weight:bold">&lt;/artifact&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;excludes&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;exclude&gt;</span>META-INF/<strong>.SF<span style="color:#070;font-weight:bold">&lt;/exclude&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;exclude&gt;</span>META-INF/</strong>.DSA<span style="color:#070;font-weight:bold">&lt;/exclude&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;exclude&gt;</span>META-INF/*.RSA<span style="color:#070;font-weight:bold">&lt;/exclude&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/excludes&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/filter&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/filters&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>shade<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;shadedClassifierName&gt;</span>shaded<span style="color:#070;font-weight:bold">&lt;/shadedClassifierName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;transformers&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span>
              <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.ContainerDependenciesTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/session&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;userArtifacts&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;artifact&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>sample-component<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;type&gt;</span>jar<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;/artifact&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/userArtifacts&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.PluginTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/session&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;userArtifacts&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;artifact&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>sample-component<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;type&gt;</span>jar<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
              <span style="color:#070;font-weight:bold">&lt;/artifact&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/userArtifacts&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/transformers&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>nested-maven-repository-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${the.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the configuration unrelated to transformers can depend your application.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ContainerDependenciesTransformer</code> is the one to embed a maven repository and <code>PluginTransformer</code> to create a file listing (one per line)
a list of artifacts (representing plugins).</p>
</div>
<div class="paragraph">
<p>Both transformers share most of their configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>session</code>: must be set to <code>${session}</code>. This is used to retrieve dependencies.</p>
</li>
<li>
<p><code>scope</code>: a comma separated list of scope to include in the artifact filtering (note that the default will rely on <code>provided</code> but you can replace it by <code>compile</code>, <code>runtime</code>, <code>runtime+compile</code>, <code>runtime+system</code>, <code>test</code>).</p>
</li>
<li>
<p><code>include</code>: a comma separated list of artifact to include in the artifact filtering.</p>
</li>
<li>
<p><code>exclude</code>: a comma separated list of artifact to exclude in the artifact filtering.</p>
</li>
<li>
<p><code>userArtifacts</code>: a list of artifacts (groupId, artifactId, version, type - optional, file - optional for plugin transformer, scope - optional) which can be forced inline - mainly useful forÂ <code>PluginTransformer</code>.</p>
</li>
<li>
<p><code>includeTransitiveDependencies</code>: should transitive dependencies of the components be included, true by default.</p>
</li>
<li>
<p><code>includeProjectComponentDependencies</code>: should project component dependencies be included, false by default (normally a job project uses isolation for components so this is not needed).</p>
</li>
<li>
<p><code>userArtifacts</code>: set of component artifacts to include.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
to use with the component tooling, it is recommended to keep default locations. Also if you feel you need to use project dependencies,
you can need to refactor your project structure to ensure you keep component isolation. Talend component let you handle that part but the recommended
practise is to use <code>userArtifacts</code> for the components and not the project <code>&lt;dependencies&gt;</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_containerdependenciestransformer">ContainerDependenciesTransformer</h5>
<div class="paragraph">
<p><code>ContainerDependenciesTransformer</code> specific configuration is the following one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>repositoryBase</code>: base repository location (default to <code>MAVEN-INF/repository</code>).</p>
</li>
<li>
<p><code>ignoredPaths</code>: a comma separated list of folder to not create in the output jar, this is common for the ones already created by other transformers/build parts.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_plugintransformer">PluginTransformer</h5>
<div class="paragraph">
<p><code>ContainerDependenciesTransformer</code> specific configuration is the following one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pluginListResource</code>: base repository location (default to TALEND-INF/plugins.properties`).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example: if you want to list only the plugins you use you can configure this transformer like that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;transformer</span> <span style="color:#b48">implementation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component.container.maven.shade.PluginTransformer</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;session&gt;</span>${session}<span style="color:#070;font-weight:bold">&lt;/session&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;include&gt;</span>org.talend.sdk.component:component-x,org.talend.sdk.component:component-y,org.talend.sdk.component:component-z<span style="color:#070;font-weight:bold">&lt;/include&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/transformer&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_component">5. Configuring component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Component are configured through their constructor parameters. They can all be marked with <code>@Option</code>
which will let you give a name to parameters (if not it will use the bytecode name which can require you to compile with <code>-parameter</code> flag
to not have <code>arg0</code>, <code>arg1</code>, &#8230;&#8203; as names).</p>
</div>
<div class="paragraph">
<p>The parameter types can be <em>primitives</em> or complex objects with fields decorated with <code>@Option</code> exactly like method parameters.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
it is recommanded to use simple models which can be serialized by components to avoid headaches when implementing serialized components.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FileFormat</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Serializable</span> {
    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">type</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> FileType type = FileType.CSV;

    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">max-records</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">int</span> maxRecords = <span style="color:#00D">1024</span>;
}

<span style="color:#007">@PartitionMapper</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">demo</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file-reader</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> MyFileReader(<span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file-path</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">File</span> file,
                    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file-format</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> FileFormat format) {
    <span style="color:#777">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this kind of API makes the configuration extensible and component oriented letting the user define all he needs.</p>
</div>
<div class="paragraph">
<p>The instantiation of the parameters is done from the properties passed to the component (see next part).</p>
</div>
<div class="sect2">
<h3 id="_primitives">5.1. Primitives</h3>
<div class="paragraph">
<p>What is considered as a primitive in this mecanism is a class which can be directly converted from a <code>String</code> to the expected type.</p>
</div>
<div class="paragraph">
<p>It obviously includes all java primitives, <code>String</code> type itself but also all the types with a <code>org.apache.xbean.propertyeditor.Converter</code>.</p>
</div>
<div class="paragraph">
<p>This includes out of the box:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BigDecimal</code></p>
</li>
<li>
<p><code>BigInteger</code></p>
</li>
<li>
<p><code>File</code></p>
</li>
<li>
<p><code>InetAddress</code></p>
</li>
<li>
<p><code>ObjectName</code></p>
</li>
<li>
<p><code>URI</code></p>
</li>
<li>
<p><code>URL</code></p>
</li>
<li>
<p><code>Pattern</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_complex_object_mapping">5.2. Complex object mapping</h3>
<div class="paragraph">
<p>The conversion from properties to object is using the dotted notation. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">file.path = /home/user/input.csv
file.format = CSV</code></pre>
</div>
</div>
<div class="paragraph">
<p>will match</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FileOptions</span> {
    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">path</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">File</span> path;

    <span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">format</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Format</span> format;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>assuming the method parameter was configured with <code>@Option("file")</code>.</p>
</div>
<div class="sect3">
<h4 id="_list_case">5.2.1. List case</h4>
<div class="paragraph">
<p>Lists use the same syntax but to define their elements their rely on an indexed syntax. Assuming the list parameter is named <code>files</code>
and the elements are of Â <code>FileOptions</code> type, here is how to define a list of 2 elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">files[0].path = /home/user/input1.csv
files[0].format = CSV
files[1].path = /home/user/input2.xml
files[2].format = EXCEL</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_map_case">5.2.2. Map case</h4>
<div class="paragraph">
<p>Inspired from the list case, the map uses <code>.key[index]</code> and <code>.value[index]</code> to represent its key and values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">// Map&lt;String, FileOptions&gt;
files.key[0] = first-file
files.value[0].path = /home/user/input1.csv
files.value[0].type = CSV
files.key[1] = second-file
files.value[1].path = /home/user/input2.xml
files.value[1].type = EXCEL</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">// Map&lt;FileOptions, String&gt;
files.key[0].path = /home/user/input1.csv
files.key[0].type = CSV
files.value[0] = first-file
files.key[1].path = /home/user/input2.xml
files.key[1].type = EXCEL
files.value[1] = second-file</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
don&#8217;t abuse of map type. If not needed for your configuration (= if you can configure your component
with an object) don&#8217;t use it.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_constraints_and_validation_on_the_configuration_input">5.3. Constraints and validation on the configuration/input</h3>
<div class="paragraph">
<p>It is common to need to add as metadata a field is required, another has a minimum size etc. This is done with the
validation in <code>org.talend.sdk.component.api.configuration.constraint</code> package:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Parameter Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Supported Types</th>
<th class="tableblock halign-left valign-top">Metadata sample</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a higher bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharSequence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::maxLength":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a lower bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharSequence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::minLength":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate the decorated string with a java pattern, you can use xregex library in javascript.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CharSequence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::pattern":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a higher bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number, int, short, byte, long, double, float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::max":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a lower bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number, int, short, byte, long, double, float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::min":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark the field as being mandatory.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::required":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a higher bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::maxItems":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the decorated option size is validated with a lower bound.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::minItems":"12.34"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.constraint.Uniques</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uniqueItems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure the elements of the collection must be distinct (kind of set).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"validation::uniqueItems":"true"}</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
using the programmatic API the metadata are prefixed by <code>tcomp::</code> but this prefix is stripped in the web for convenience,
the previous table uses the web keys.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_marking_a_configuration_as_a_particular_type_of_data">5.4. Marking a configuration as a particular type of data</h3>
<div class="paragraph">
<p>It is common to classify the incoming data. You can see it as tagging them in several types. The most common ones
are the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>datastore: all the data you need to connect to the backend</p>
</li>
<li>
<p>dataset: a datastore coupled with all the data you need to execute an action</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Metadata sample</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.talend.sdk.component.api.configuration.type.DataStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">datastore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a model (complex object) as being a datastore (connection to a backend).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"tcomp::configurationtype::type":"datastore","tcomp::configurationtype::name":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.talend.sdk.component.api.configuration.type.DataSet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dataset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a model (complex object) as being a dataset.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"tcomp::configurationtype::type":"dataset","tcomp::configurationtype::name":"test"}</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
the component family associated with a configuration type (datastore/dataset) is always the one related
to the component using that configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Those configuration types can be composed to provide one configuration item. For example a dataset type will often need a datastore
type to be provided. and a datastore type (that provides the connection information) will be used to create a dataset type.</p>
</div>
<div class="paragraph">
<p>Those configuration types will also be used at design time to create shared configuration that can be stored and used at runtime.</p>
</div>
<div class="paragraph">
<p>For example, we can think about a relational database that support JDBC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A datastore may provide:</p>
<div class="ulist">
<ul>
<li>
<p>jdbc url, username, password</p>
</li>
</ul>
</div>
</li>
<li>
<p>A dataset may be:</p>
<div class="ulist">
<ul>
<li>
<p>datastore (that will provide the connection data to the database)</p>
</li>
<li>
<p>table name, data []</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The component server will scan all those configuration types and provide a configuration type index. This index can be used for the integration
into the targeted platforms (studio, web applications&#8230;&#8203;)</p>
</div>
<div class="paragraph">
<p>The configuration type index is represented as a flat tree that contains all the configuration types represented as nodes and indexed by their ids.</p>
</div>
<div class="paragraph">
<p>Also, every node can point to other nodes. This relation is represented as an array of edges that provide the childes ids.</p>
</div>
<div class="paragraph">
<p>For example, a configuration type index for the above example will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span style="color:#F00;background-color:#FAA">n</span><span style="color:#F00;background-color:#FAA">o</span><span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">s</span>: {
             <span style="color:#606"><span style="color:#404">&quot;</span><span>idForDstore</span><span style="color:#404">&quot;</span></span>: { <span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">t</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">s</span><span style="color:#F00;background-color:#FAA">t</span><span style="color:#F00;background-color:#FAA">o</span><span style="color:#F00;background-color:#FAA">r</span><span style="color:#F00;background-color:#FAA">e</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">datastore data</span><span style="color:#710">&quot;</span></span>, <span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">g</span><span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">s</span>:[<span style="color:#F00;background-color:#FAA">i</span><span style="color:#F00;background-color:#FAA">d</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">idForDset</span><span style="color:#710">&quot;</span></span>] },
             <span style="color:#606"><span style="color:#404">&quot;</span><span>idForDset</span><span style="color:#404">&quot;</span></span>:   { <span style="color:#F00;background-color:#FAA">d</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">t</span><span style="color:#F00;background-color:#FAA">a</span><span style="color:#F00;background-color:#FAA">s</span><span style="color:#F00;background-color:#FAA">e</span><span style="color:#F00;background-color:#FAA">t</span>:<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">dataset data</span><span style="color:#710">&quot;</span></span> }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_define_links_between_properties">5.5. Define links between properties</h3>
<div class="paragraph">
<p>It can be needed to define a binding between properties, a set of annotations allows to do it:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Metadata Sample</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.condition.ActiveIf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the evaluation of the element at the location matches value then the element is considered active, otherwise it is deactivated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"condition::if::target":"test","condition::if::value":"value1,value2"}</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Target element location is specified as a relative path to current location using Unix path characters.
Configuration class delimiter is <code>/</code>. Parent configuration class is specified by <code>..</code>.
Thus <code>../targetProperty</code> denotes a property, which is located in parent configuration class and has name <code>targetProperty</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
using the programmatic API the metadata are prefixed by <code>tcomp::</code> but this prefix is stripped in the web for convenience,
the previous table uses the web keys.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="documentation-ui-hints">5.6. Add hints about the rendering based on configuration/component knowledge</h3>
<div class="paragraph">
<p>In some case it can be needed to add some metadata about the configuration to let the UI render properly the configuration.
A simple example is a password value must be hidden and not a simple clear input box. For these cases - when the component developper
wants to influence the UI rendering - you can use a particular set of annotations:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Generated property metadata</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.DefaultValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provide a default value the UI can use - only for primitive fields.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::defaultvalue::value":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.OptionsOrder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to sort a class properties.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::optionsorder::value":"value1,value2"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.AutoLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request the rendered to do what it thinks is best.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::autolayout":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.GridLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced layout to place properties by row, this is exclusive with <code>@OptionsOrder</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::gridlayout::value1::value":"first</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">second,third","ui::gridlayout::value2::value":"first</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">second,third"}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.GridLayouts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow to configure multiple grid layouts on the same class, qualified with a classifier (name)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::gridlayout::Advanced::value":"another","ui::gridlayout::Main::value":"first</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">second,third"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.HorizontalLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put on a configuration class it notifies the UI an horizontal layout is preferred.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::horizontallayout":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.layout.VerticalLayout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put on a configuration class it notifies the UI a vertical layout is preferred.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::verticallayout":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a field as being represented by some code widget (vs textarea for instance).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::code::value":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.Credential</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a field as being a credential. It is typically used to hide the value in the UI.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::credential":"true"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.Structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a List&lt;String&gt; or Map&lt;String, String&gt; field as being represented as the component data selector (field names generally or field names as key and type as value).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::structure::type":"null","ui::structure::value":"test"}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.configuration.ui.widget.TextArea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a field as being represented by a textarea(multiline text input).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{"ui::textarea":"true"}</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
using the programmatic API the metadata are prefixed by <code>tcomp::</code> but this prefix is stripped in the web for convenience,
the previous table uses the web keys.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
target support should cover <code>org.talend.core.model.process.EParameterFieldType</code> but we need to ensure web renderers is able to handle the same widgets.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_providing_some_actions_for_consumers_clients">6. Providing some actions for consumers/clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases you will desire to add some actions unrelated to the runtime. A simple example
is to enable clients - the users of the plugin/library - to test if a connection works. Even more concretely: <em>does my database is up?</em>.</p>
</div>
<div class="paragraph">
<p>To do so you need to define an <code>@Action</code> which is a method with a name (representing the event name) in a class decorated with <code>@Service</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Service</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyDbTester</span> {
    <span style="color:#007">@Action</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mycomp</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">public</span> Status doTest(<span style="color:#088;font-weight:bold">final</span> IncomingData data) {
        <span style="color:#080;font-weight:bold">return</span> ...;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
services are singleton so if you need some thread safety ensure they match that requirement. They
shouldn&#8217;t store any state too (state is held by the component) since they can be serialized any time.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
services are usable in components as well (matched by type) and allow to reuse some shared logic like a client. Here is a sample
with a service used to access files:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Emitter</span>(family = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">PersonReader</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a8;font-weight:bold">Serializable</span> {
    <span style="color:#777">// attributes skipped to be concise</span>

    <span style="color:#088;font-weight:bold">public</span> PersonReader(<span style="color:#007">@Option</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>) <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">File</span> file,
                        <span style="color:#088;font-weight:bold">final</span> FileService service) {
        <span style="color:#950">this</span>.file = file;
        <span style="color:#950">this</span>.service = service;
    }

    <span style="color:#777">// use the service</span>
    <span style="color:#007">@PostConstruct</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> open() <span style="color:#088;font-weight:bold">throws</span> <span style="color:#C00;font-weight:bold">FileNotFoundException</span> {
        reader = service.createInput(file);
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
service is passed to constructor automatically, it can be used as a bean. Only call of service&#8217;s method is required.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_particular_action_types">6.1. Particular action types</h3>
<div class="paragraph">
<p>Some actions are that common and need a clear contract so they are defined as API first citizen, this is the case for wizards or healthchecks
for instance. Here is the list of all actions:</p>
</div>
<table class="tableblock frame-all grid-all table-striped table-hover table-ordered">
<colgroup>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Return type</th>
<th class="tableblock halign-left valign-top">Sample returned type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.completion.DynamicValues</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dynamic_values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a method as being useful to fill potential values of a string option for a property denoted by its value. You can link a field as being completable using @Proposable(value). The resolution of the completion action is then done through the component family and value of the action. The callback doesn&#8217;t take any parameter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"items":[{"id":"value","label":"label"}]}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.healthcheck.HealthCheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">healthcheck</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This class marks an action doing a connection test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HealthCheckStatus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"comment":"Something went wrong","status":"KO"}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.schema.DiscoverSchema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark an action as returning a discovered schema. Its parameter MUST be the type decorated with <code>@Discoverable</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"entries":[{"name":"column1","type":"STRING"}]}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.Action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@org.talend.sdk.component.api.service.asyncvalidation.AsyncValidation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark a method as being used to validate a configuration. IMPORTANT: this is a server validation so only use it if you can&#8217;t use other client side validation to implement it.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ValidationResult</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{"comment":"Something went wrong","status":"KO"}</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_built_in_services">7. Built in services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The framework provides some built-in services you can inject by type in components and actions out of the box.</p>
</div>
<div class="paragraph">
<p>Here is the list:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>org.talend.sdk.component.api.service.cache.LocalCache</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a small abstraction to cache data which don&#8217;t need to be recomputed very often. Commonly used by actions for the UI interactions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>org.talend.sdk.component.api.service.dependency.Resolver</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Allows to resolve a dependency from its Maven coordinates.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
it assumes the dependency is locally available to the execution instance which is not guaranteed yet by the framework.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>org.talend.sdk.component.api.service.configuration.LocalConfiguration</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Represents the local configuration which can be used during the design.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
it is not recommanded to use it for the runtime since the local configuration is generally different and the instances are distincts.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you can also use the local cache as an interceptor with <code>@Cached</code>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Every interface that extends <code>HttpClient</code> and that contains methods annotated with <code>@Request</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This let you define an http client in a declarative manner using an annotated interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See the <a href="#_httpclient_usage">HttpClient usage</a> for details.
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="_httpclient_usage">7.1. HttpClient usage</h3>
<div class="paragraph">
<p>Let assume that we have a REST API defined like below, and that it requires a basic authentication header.</p>
</div>
<div class="paragraph">
<p>GET     <code>/api/records/{id}</code></p>
</div>
<div class="paragraph">
<p>POST    <code>/api/records</code>      &#8658; with a json playload to be created <code>{"id":"some id", "data":"some data"}</code></p>
</div>
<div class="paragraph">
<p>To create an http client able to consume this REST API, we will define an interface that extends <code>HttpClient</code>,</p>
</div>
<div class="paragraph">
<p>The <code>HttpClient</code> interface lets you set the <code>base</code> for the http address that our client will hit.</p>
</div>
<div class="paragraph">
<p>The <code>base</code> is the part of the address that we will need to add to the request path to hit the api.</p>
</div>
<div class="paragraph">
<p>Every method annotated with <code>@Request</code> of our interface will define an http request.
Also every request can have <code>@Codec</code> that let us encode and decode the request playloads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">interface</span> <span style="color:#B06;font-weight:bold">APIClient</span> <span style="color:#088;font-weight:bold">extends</span> HttpClient {
    <span style="color:#007">@Request</span>(path = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">api/records/{id}</span><span style="color:#710">&quot;</span></span>, method = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">GET</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#007">@Codec</span>(decoder = RecordDecoder.class) <span style="color:#777">//decoder =  decode return data to Record class</span>
    Record getRecord(<span style="color:#007">@Header</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Authorization</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">String</span> basicAuth, <span style="color:#007">@Path</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span>) <span style="color:#339;font-weight:bold">int</span> id);

    <span style="color:#007">@Request</span>(path = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">api/records</span><span style="color:#710">&quot;</span></span>, method = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">POST</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#007">@Codec</span>(encoder = RecordEncoder.class, decoder = RecordDecoder.class) <span style="color:#777">//encoder = encode record to fit request format (json n this example)</span>
    Record createRecord(<span style="color:#007">@Header</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Authorization</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">String</span> basicAuth, Record record);
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The interface should extends <code>HttpClient</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This interface can be injected into our Components classes or Services to consume the defined api.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Service</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyService</span> {

    <span style="color:#088;font-weight:bold">private</span> APIClient client;

    <span style="color:#088;font-weight:bold">public</span> MyService(...,APIClient client){
        <span style="color:#777">//...</span>
        <span style="color:#950">this</span>.client = client;
        client.base(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://localhost:8080</span><span style="color:#710">&quot;</span></span>);<span style="color:#777">// init the base of the api, ofen in a PostConstruct or init method</span>
    }

    <span style="color:#777">//...</span>
    <span style="color:#777">// Our get request</span>
    Record rec =  client.getRecord(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Basic MLFKG?VKFJ</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">100</span>);

    <span style="color:#777">//...</span>
    <span style="color:#777">// Our post request</span>
    Record newRecord = client.createRecord(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Basic MLFKG?VKFJ</span><span style="color:#710">&quot;</span></span>, <span style="color:#080;font-weight:bold">new</span> Record());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_services_and_interceptors">8. Services and interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For common concerns like caching, auditing etc, it can be fancy to use interceptor like API. It is enabled by the framework
on services.</p>
</div>
<div class="paragraph">
<p>An interceptor defines an annotation marked with <code>@Intercepts</code> which defines the implementation of the interceptor (an <code>InterceptorHandler</code>).</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Intercepts</span>(LoggingHandler.class)
<span style="color:#007">@Target</span>({ TYPE, METHOD })
<span style="color:#007">@Retention</span>(RUNTIME)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#007">@interface</span> Logged {
    <span style="color:#0a8;font-weight:bold">String</span> value();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then handler is created from its constructor and can take service injections (by type). The first parameter, however, can be
a <code>BiFunction&lt;Method, Object[], Object&gt;</code> which representes the invocation chain if your interceptor can be used with others.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
if you do a generic interceptor it is important to pass the invoker as first parameter. If you don&#8217;t do so
you can&#8217;t combine interceptors at all.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an interceptor implementation for our <code>@Logged</code> API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">LoggingHandler</span> <span style="color:#088;font-weight:bold">implements</span> InterceptorHandler {
    <span style="color:#777">// injected</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> BiFunction&lt;<span style="color:#0a8;font-weight:bold">Method</span>, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>, <span style="color:#0a8;font-weight:bold">Object</span>&gt; invoker;
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> SomeService service;

    <span style="color:#777">// internal</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">ConcurrentMap</span>&lt;<span style="color:#0a8;font-weight:bold">Method</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt; loggerNames = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ConcurrentHashMap</span>&lt;&gt;();

    <span style="color:#088;font-weight:bold">public</span> CacheHandler(<span style="color:#088;font-weight:bold">final</span> BiFunction&lt;<span style="color:#0a8;font-weight:bold">Method</span>, <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span>, <span style="color:#0a8;font-weight:bold">Object</span>&gt; invoker, <span style="color:#088;font-weight:bold">final</span> SomeService service) {
        <span style="color:#950">this</span>.invoker = invoker;
        <span style="color:#950">this</span>.service = service;
    }

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Object</span> invoke(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Method</span> method, <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Object</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> name = loggerNames.computeIfAbsent(method, m -&gt; findAnnotation(m, Logged.class).get().value());
        service.getLogger(name).info(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Invoking {}</span><span style="color:#710">&quot;</span></span>, method.getName());
        <span style="color:#080;font-weight:bold">return</span> invoker.apply(method, args);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This implementation is compatible with interceptor chains since it takes the invoker as first constructor parameter
and it also takes a service injection. Then the implementation just does what is needed - logging the invoked method here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the <code>findAnnotation</code> annotation - inherited from <code>InterceptorHandler</code> is an utility method to find an annotation on a method
or class (in this order).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_an_execution_chain_or_pipeline">9. Creating an execution chain or pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two kind of chains the framework supports:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>standalone chains</p>
</li>
<li>
<p><a href="https://beam.apache.org/">Beam</a> chains</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_standalone_chains">9.1. Standalone chains</h3>
<div class="paragraph">
<p>For now the standalone chains only support linear flows (more to come) and are built based on a <code>ExecutionChainBuilder</code>.</p>
</div>
<div class="paragraph">
<p>This one will take some metadata about the flow (which input with which configuration, which processors, which processor order and configuration&#8230;&#8203;)
and will execute it linearly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExecutionChainBuilder.start()
        .withConfiguration(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SampleJob</span><span style="color:#710">&quot;</span></span>, <span style="color:#069">true</span>) <i class="conum" data-value="1"></i><b>(1)</b>
        .withInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{ <i class="conum" data-value="2"></i><b>(2)</b>
            put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/input.csv</span><span style="color:#710">&quot;</span></span>);
        }})
        .toProcessor(<span style="color:#069">null</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">2</span>, emptyMap()) <i class="conum" data-value="2"></i><b>(2)</b>
        .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reject</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{ <i class="conum" data-value="2"></i><b>(2)</b>
            put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/output.csv</span><span style="color:#710">&quot;</span></span>);
        }}).getParent()
        .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reject</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{ <i class="conum" data-value="2"></i><b>(2)</b>
            put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/output.csv</span><span style="color:#710">&quot;</span></span>);
        }})
        .create(manager, plugin -&gt; <span style="color:#069">null</span>, <span style="color:#080;font-weight:bold">new</span> CountingSuccessListener(), <span style="color:#080;font-weight:bold">new</span> ToleratingErrorHandler(<span style="color:#00D">0</span>)) <i class="conum" data-value="3"></i><b>(3)</b>
        .get()
        .execute(); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure some global execution configuration, like giving it a name and if system properties can override the component configuration
using <code>&lt;component group name&gt;.&lt;component name&gt;.&lt;configuration property name&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Each component is registered from its component name (what is passed in <code>family</code> of the component annotation),
its own name (<code>name</code> method of the annotation) and its configuration as a map (2).</p>
</div>
<div class="paragraph">
<p>Once the flow is defined (there is no more processor after), then you can create the <code>ExecutionChain</code> (3) with its success/error listeners
to handle it in a custom manner and finally you can get it and execute the flow/pipeline (4).</p>
</div>
<div class="paragraph">
<p>A chain needs a <code>ComponentManager</code> which is the manager of the plugins. The easiest is to use its default constructor to create one instance.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this manager needs to be closed when no more needed so don&#8217;t forget to call close.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is a sample code for the previous chain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#088;font-weight:bold">final</span> ComponentManager manager = ComponentManager.instance()
        ExecutionChainBuilder.start()
                .withConfiguration(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SampleJob</span><span style="color:#710">&quot;</span></span>, <span style="color:#069">true</span>)
                .fromInput(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/input.csv</span><span style="color:#710">&quot;</span></span>);
                }})
                .toProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">rejected</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, emptyMap())
                .getParent()
                .toProcessor(Branches.DEFAULT_BRANCH, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, emptyMap())
                .toProcessor(Branches.DEFAULT_BRANCH, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">3</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">file</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/tmp/output.csv</span><span style="color:#710">&quot;</span></span>);
                }})
                .create(manager, plugin -&gt; <span style="color:#069">null</span>, <span style="color:#080;font-weight:bold">new</span> CountingSuccessListener(), <span style="color:#080;font-weight:bold">new</span> ToleratingErrorHandler(<span style="color:#00D">0</span>))
                .get()
                .execute();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
this API is not very powerful but allows to test simple cases, you can have a look to beam direct runner and the Talend Component beam bridge
for more advanced cases.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
the number before the configuration (map) is the version of this configuration, it allows to automatically migrate
from a version to the currently available one when needed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_beam_case">9.2. Beam case</h3>
<div class="paragraph">
<p>For beam case, you need to rely on beam pipeline definition and use <code>component-runtime-beam</code> dependency which provides Beam bridges.</p>
</div>
<div class="sect3">
<h4 id="_i_o">9.2.1. I/O</h4>
<div class="paragraph">
<p><code>org.talend.sdk.component.runtime.beam.TalendIO</code> provides a way to convert a partition mapper or a processor to an input or processor
using the <code>read</code> or <code>write</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#088;font-weight:bold">final</span> ComponentManager manager = ComponentManager.instance()
        Pipeline pipeline = Pipeline.create();
        <span style="color:#777">//Create beam input from mapper and apply input to pipeline</span>
        pipeline.apply(TalendIO.read(manager.findMapper(manager.findMapper(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">reader</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">fileprefix</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">input</span><span style="color:#710">&quot;</span></span>);
                }}).get()))
                .apply(<span style="color:#080;font-weight:bold">new</span> ViewsMappingTransform&lt;&gt;(emptyMap())) <span style="color:#777">// prepare it for the output record format (see next part)</span>
        <span style="color:#777">//Create beam processor from talend processor and apply to pipeline</span>
                .apply(TalendIO.write(manager.findProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">test</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">writer</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">HashMap</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, <span style="color:#0a8;font-weight:bold">String</span>&gt;() {{
                    put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">fileprefix</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">output</span><span style="color:#710">&quot;</span></span>);
                }}).get(), emptyMap()));

        <span style="color:#777">//... run pipeline</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processors">9.2.2. Processors</h4>
<div class="paragraph">
<p><code>org.talend.sdk.component.runtime.beam.TalendFn</code> provides the way to wrap a processor in a Beam <code>PTransform</code> and integrate it in the pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Main</span> {
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#777">//Component manager and pipeline initialization...</span>

        <span style="color:#777">//Create beam PTransform from processor and apply input to pipeline</span>
        pipeline.apply(TalendFn.asFn(manager.findProcessor(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">sample</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mapper</span><span style="color:#710">&quot;</span></span>, <span style="color:#00D">1</span>, emptyMap())).get())), emptyMap());

        <span style="color:#777">//... run pipeline</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The multiple inputs/outputs are represented by a <code>Map</code> element in beam case to avoid to use multiple inputs/outputs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
you can use <code>ViewsMappingTransform</code> or <code>CoGroupByKeyResultMappingTransform</code> to adapt the input/output
format to this <code>Map&lt;String, List&lt;Serializable&gt;&gt;</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_deployment">9.2.3. Deployment</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Beam serializing components it is crucial to add <code>component-runtime-standalone</code> dependency to the project. It will take
care of providing an implicit and lazy <code>ComponentManager</code> managing the component in a fatjar case.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_convert_a_beam_io_in_a_component_i_o">9.2.4. Convert a Beam.io in a component I/O</h4>
<div class="paragraph">
<p>For simple I/O you can get automatic conversion of the Beam.io to a component I/O transparently if you decorated your <code>PTransform</code>
with <code>@PartitionMapper</code> or <code>@Processor</code>.</p>
</div>
<div class="paragraph">
<p>The limitation are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inputs must implement <code>PTransform&lt;PBegin, PCollection&lt;?&gt;&gt;</code> and must be a <code>BoundedSource</code>.</p>
</li>
<li>
<p>Outputs must implement <code>PTransform&lt;PCollection&lt;?&gt;, PDone&gt;</code> and just register on the input <code>PCollection</code> a <code>DoFn</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More information on that topic on <a href="wrapping-a-beam-io.html">How to wrap a Beam I/O</a> page.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_plugin">10. Maven Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>talend-component-maven-plugin</code> intends to help you to write components
validating components match best practices and also generating transparently metadata used by Talend Studio.</p>
</div>
<div class="paragraph">
<p>Here is how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this plugin is also an extension so you can declare it in your <code>build/extensions</code> block as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;extension&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Used as an extension, <code>dependencies</code>, <code>validate</code> and <code>documentation</code> goals will be set up.</p>
</div>
<div class="sect2">
<h3 id="_dependencies_2">10.1. Dependencies</h3>
<div class="paragraph">
<p>The first goal is a shortcut for the <code>maven-dependency-plugin</code>, it will create the <code>TALEND-INF/dependencies.txt</code> file
with the <code>compile</code> and <code>runtime</code> dependencies to let the component use it at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>talend-dependencies<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>dependencies<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validate">10.2. Validate</h3>
<div class="paragraph">
<p>The most important goal is here to help you to validate the common programming model of the component. Here is the execution definition to activate it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>talend-component-validate<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>validate<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default it will be bound to <code>process-classes</code> phase. When executing it will do several validations which can be switched off
adding the corresponding flags to <code>false</code> in the <code>&lt;configuration&gt;</code> block of the execution:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateInternationalization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates resource bundle are presents and contain commonly used keys (like <code>_displayName</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateModel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure components pass validations of the <code>ComponentManager</code> and Talend Component runtime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateSerializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure components are <code>Serializable</code> - note this is a sanity check, the component is not actually serialized here, if you have a doubt ensure to test it. It also checks any <code>@Internationalized</code> class is valid and has its keys.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateMetadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure components define an <code>@Icon</code> and <code>@Version</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateDataStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure any  <code>@DataStore</code> defines a <code>@HealthCheck</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateComponent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure native programming model is respected, you can disable it when using another programming model like in beam case.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateActions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate actions signatures for the ones not tolerating dynamic binding (<code>@HealthCheck</code>, <code>@DynamicValues</code>, &#8230;&#8203;). It is recommanded to keep it <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateFamily</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate the family, i.e. the package containing the <code>@Components</code> has also a <code>@Icon</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validateDocumentation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure all 1. components and 2. <code>@Option</code> properties have a documentation using <code>@Documentation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_documentation">10.3. Documentation</h3>
<div class="paragraph">
<p>This goal generates an Asciidoc file documenting your component from the configuration model (<code>@Option</code>) and
<code>@Documentation</code> you can put on options and the component itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>talend-component-documentation<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Which level are the root title</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>2 which means <code>==</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">output</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Where to store the output, it is <strong>NOT</strong> recommended to change it</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>${classes}/TALEND-INF/documentation.adoc</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">formats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map of the renderings to do, keys are the format (<code>pdf</code> or <code>html</code>) and values the output paths</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A map of asciidoctor attributes when formats is set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateDir / templateEngine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Template configuration for the rendering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Document title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">${project.name}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attachDocumentations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the documentations (<code>.adoc</code>, and <code>formats</code> keys) should be attached to the project (and deployed)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if you use the extension you can add the property <code>talend.documentation.htmlAndPdf</code> and set it to <code>true</code> in your project
to automatically get a html and PDF rendering of the documentation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_render_your_documentation">10.3.1. Render your documentation</h4>
<div class="sect4">
<h5 id="_html">HTML</h5>
<div class="paragraph">
<p>To render the generated documentation you can use the Asciidoctor Maven plugin (or Gradle equivalent):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span> (1)
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component-kit.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>documentation<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span>
<span style="color:#070;font-weight:bold">&lt;plugin&gt;</span> (2)
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctor-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.6<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>doc-html<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>process-asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.build.outputDirectory}/TALEND-INF<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDocumentName&gt;</span>documentation.adoc<span style="color:#070;font-weight:bold">&lt;/sourceDocumentName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/documentation<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;backend&gt;</span>html5<span style="color:#070;font-weight:bold">&lt;/backend&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Will generate in <code>target/classes/TALEND-INF/documentation.adoc</code> the components documentation.</p>
</li>
<li>
<p>Will render the documenation as an html file in <code>target/documentation/documentation.html</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ensure to execute it after the documentation generation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_pdf">PDF</h5>
<div class="paragraph">
<p>If you prefer a PDF rendering you can configure the following execution
in the asciidoctor plugin (note that you can configure both executions if you want
both HTML and PDF rendering):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctor-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.6<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>doc-html<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>process-asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.build.outputDirectory}/TALEND-INF<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDocumentName&gt;</span>documentation.adoc<span style="color:#070;font-weight:bold">&lt;/sourceDocumentName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/documentation<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;backend&gt;</span>pdf<span style="color:#070;font-weight:bold">&lt;/backend&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctorj-pdf<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.0-alpha.16<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_include_the_documentation_into_a_document">Include the documentation into a document</h5>
<div class="paragraph">
<p>If you want to add some more content or add a title, you can include the generated document into
another document using Asciidoc <code>include</code> directive.</p>
</div>
<div class="paragraph">
<p>A common example is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="adoc">= Super Components
Super Writer
:toc:
:toclevels: 3
:source-highlighter: prettify
:numbered:
:icons: font
:hide-uri-scheme:
:imagesdir: images

Unresolved directive in &lt;stdin&gt; - include::{generated_doc}/documentation.adoc[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This assumes you pass to the plugin the attribute <code>generated_doc</code>, this can be done this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.asciidoctor<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>asciidoctor-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>1.5.6<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>doc-html<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>prepare-package<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>process-asciidoc<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDirectory&gt;</span>${project.basedir}/src/main/asciidoc<span style="color:#070;font-weight:bold">&lt;/sourceDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;sourceDocumentName&gt;</span>my-main-doc.adoc<span style="color:#070;font-weight:bold">&lt;/sourceDocumentName&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;outputDirectory&gt;</span>${project.build.directory}/documentation<span style="color:#070;font-weight:bold">&lt;/outputDirectory&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;backend&gt;</span>html5<span style="color:#070;font-weight:bold">&lt;/backend&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;attributes&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;generated_adoc&gt;</span>${project.build.outputDirectory}/TALEND-INF<span style="color:#070;font-weight:bold">&lt;/generated_adoc&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/attributes&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is optional but allows to reuse maven placeholders to pass paths which is quite convenient in an automated build.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more">More</h5>
<div class="paragraph">
<p>You can find more customizations on Asciidoctor <a href="http://asciidoctor.org/docs/asciidoctor-maven-plugin/">website</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prepare">10.4. Prepare</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
this goal is deprecated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>prepare</code> goal is to build artifacts you can deploy out of the box into the studio. It is a temporarly phase
until the framework programming model is fully integrated in Talend suite.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>talend-component-prepare<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>prepare<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It will generate a maven project in <code>${project.build.directory}/oldtcomponentbridgemojo_workdir</code> which contains the artifacts
you can deploy to the studio. Here is the associated configuration:</p>
</div>
<table class="tableblock frame-all grid-all">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attach</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">attach the built virtual artifacts (definition and runtime modules) to the build/project (enables to deploy them)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">componentNgApiVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The component API version, if set to <code>auto</code> uses the one of the plugin (recommanded)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">componentsApiVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bridge component API version, if set to <code>auto</code> uses the one of the plugin (recommanded)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">studioHome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set and <code>attach</code> is true, the created component will be installed in the studio located at that path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if you configure a <code>studio</code> profile in your ~/.m2/settings.xml, you can activate/deactivate the deployment into the studio of your component
with a profile (adding <code>-Pstudio</code> to you build command, ex: <code>mvn clean install -Pstudio</code>). Here is a sample declaration of such a profile:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;profile&gt;</span> <span style="color:#777">&lt;!-- to deploy in the studio at build time: mvn clean install -Pstudio --&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;id&gt;</span>studio<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;properties&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;talend.component.studioHome&gt;</span>/opt/talend/TOS_DI-V6.5.0<span style="color:#070;font-weight:bold">&lt;/talend.component.studioHome&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/properties&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/profile&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generate_inputs_or_outputs">10.5. Generate inputs or outputs</h3>
<div class="paragraph">
<p>The Mojo <code>generate</code> (maven plugin goal) of the same plugin also embeds a generator you can use to bootstrap any input or output component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;executions&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>generate-input<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>generate-sources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>generate<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;type&gt;</span>input<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;execution&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span style="color:#070;font-weight:bold">&lt;id&gt;</span>generate-output<span style="color:#070;font-weight:bold">&lt;/id&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;phase&gt;</span>generate-sources<span style="color:#070;font-weight:bold">&lt;/phase&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;goals&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;goal&gt;</span>generate<span style="color:#070;font-weight:bold">&lt;/goal&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/goals&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;type&gt;</span>output<span style="color:#070;font-weight:bold">&lt;/type&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/execution&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;/executions&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generates an input (partition mapper + emitter)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generates an output</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is intended to be used from the command line (or IDE Maven integration):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sh">$ mvn talend-component:generate \
    -Dtalend.generator.type=[input|output] \ <i class="conum" data-value="1"></i><b>(1)</b>
    [-Dtalend.generator.classbase=com.test.MyComponent] \ <i class="conum" data-value="2"></i><b>(2)</b>
    [-Dtalend.generator.family=my-family] \ <i class="conum" data-value="3"></i><b>(3)</b>
    [-Dtalend.generator.pom.read-only=false] <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>select the type of component you want, <code>input</code> to generate a mapper and emitter and <code>output</code> to generate an output processor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the class name base (will be suffixed by the component type), if not set the package will be guessed and classname based on the basedir name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>set the component family to use, default to the base dir name removing (component[s] from the name, ex: <code>my-component</code> will lead to <code>my</code> as family if not explicitly set)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>should the generator try to add <code>component-api</code> in the pom if not already here, if you added it you can set it to <code>false</code> directly in the pom</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this command to work you will need to just register the plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.talend.sdk.component<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>talend-component-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;version&gt;</span>${talend-component.version}<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_plugin">11. Gradle Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>gradle-talend-component</code> intends to help you to write components
validating components match best practices. It is inspired from the Maven plugin
and adds the ability to generate automatically the <code>dependencies.txt</code> file the SDK
uses to build the component classpath. For more information on the configuration
you can check out the maven properties matching the attributes.</p>
</div>
<div class="paragraph">
<p>Here is how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
  repositories {
    mavenLocal()
    mavenCentral()
  }
  dependencies {
    classpath <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.talend.sdk.component:gradle-talend-component:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>talendComponentVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
  }
}

apply <span style="color:#606">plugin</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">org.talend.sdk.component</span><span style="color:#710">'</span></span>
apply <span style="color:#606">plugin</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">java</span><span style="color:#710">'</span></span>

<span style="color:#777">// optional customization</span>
talendComponentKit {
    <span style="color:#777">// dependencies.txt generation, replaces maven-dependency-plugin</span>
    dependenciesLocation = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">TALEND-INF/dependencies.txt</span><span style="color:#710">&quot;</span></span>
    <span style="color:#339;font-weight:bold">boolean</span> skipDependenciesFile = <span style="color:#069">false</span>;

    <span style="color:#777">// classpath for validation utilities</span>
    sdkVersion = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>talendComponentVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
    apiVersion = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>talendComponentApiVersion<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>

    <span style="color:#777">// documentation</span>
    skipDocumentation = <span style="color:#069">false</span>
    documentationOutput = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">File</span>(....)
    documentationLevel = <span style="color:#00D">2</span> <span style="color:#777">// first level will be == in the generated adoc</span>
    documentationTitle = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My Component Family</span><span style="color:#710">'</span></span> <span style="color:#777">// default to project name</span>
    documentationFormats = [:] <span style="color:#777">// adoc attributes</span>
    documentationFormats = [:] <span style="color:#777">// renderings to do</span>

    <span style="color:#777">// validation</span>
    skipValidation = <span style="color:#069">false</span>
    validateFamily = <span style="color:#069">true</span>
    validateSerializable = <span style="color:#069">true</span>
    validateInternationalization = <span style="color:#069">true</span>
    validateModel = <span style="color:#069">true</span>
    validateMetadata = <span style="color:#069">true</span>
    validateComponent = <span style="color:#069">true</span>
    validateDataStore = <span style="color:#069">true</span>
    validateDataSet = <span style="color:#069">true</span>
    validateActions = <span style="color:#069">true</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_define_a_custom_api">12. Advanced: define a custom API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to extend the Component API for custom front features.</p>
</div>
<div class="paragraph">
<p>What is important here is to keep in mind you should do it
only if it targets not portable components (only used by the Studio or Beam).</p>
</div>
<div class="paragraph">
<p>In term of organization it is recommanded to create a custom <code>xxxx-component-api</code> module with the new set of annotations.</p>
</div>
<div class="sect2">
<h3 id="_extending_the_ui">12.1. Extending the UI</h3>
<div class="paragraph">
<p>To extend the UI just add an annotation which can be put on <code>@Option</code> fields which is decorated with <code>@Ui</code>.
All its members will be put in the metadata of the parameter. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#007">@Ui</span>
<span style="color:#007">@Target</span>(TYPE)
<span style="color:#007">@Retention</span>(RUNTIME)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#007">@interface</span> MyLayout {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
            </div>
            
        </div>
    </div>


    <footer>
        <div class="row">
          <div class="col-lg-12">

            <ul class="list-unstyled">
              <li class="pull-right"><a href="#top">Back to top</a></li>
            </ul>
          </div>
        </div>
    </footer>
    </div>

    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.js"></script>
  </body>
</html>

